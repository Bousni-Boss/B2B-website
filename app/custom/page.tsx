'use client';import NavBar from '@/components/NavBar';import { useEffect,useState } from 'react';import { CATEGORY_DISPLAY,isCategory } from '@/lib/categories';import { getGemPolicyForCategory } from '@/lib/gem-policy';import ColorQtyMatrix from '@/components/ColorQtyMatrix';import type { VariantRow } from '@/lib/types';import SpecFieldset from '@/components/SpecFieldset';const DEFAULT_COLORS=['White Gold','Yellow Gold','Red/Rose Gold'];export default function CustomOrderPage(){const [role,setRole]=useState<string>('client');const [category,setCategory]=useState<string>('');const [details,setDetails]=useState('');const [variants,setVariants]=useState<VariantRow[]>([{color:DEFAULT_COLORS[0],qty:1}]);const [specs,setSpecs]=useState<Record<string,any>>({});useEffect(()=>{fetch('/api/whoami').then(r=>r.json()).then(d=>setRole(d.session?.role??'client'));},[]);function submit(){if(!isCategory(category)){alert('Please choose a category');return;}alert('Submitted! Category: '+category+'. We will respond within 24-48 hours.');}const policy = isCategory(category)?getGemPolicyForCategory(category):({kind:'Simple'} as any);return(<div><NavBar role={role}/><main className='container' style={{paddingTop:24}}><h1>Custom order</h1><p style={{color:'var(--muted)'}}>Upload images and describe your request. We will respond within 24-48 hours.</p><div className='row cols-2' style={{marginTop:16}}><div className='card'><div className='img-ph' style={{height:120}}>Upload zone (placeholder)</div><div style={{display:'flex',gap:8,marginTop:8}}><select className='input' value={category} onChange={e=>setCategory((e.target as HTMLSelectElement).value)}><option value=''>Select category...</option>{CATEGORY_DISPLAY.map(c=><option key={c} value={c}>{c}</option>)}</select><button className='button'>Select files</button><button className='button button-primary' onClick={submit}>Submit</button></div></div><div className='card'><div className='text-sm' style={{fontWeight:600,marginBottom:6}}>Colors & Quantities</div><ColorQtyMatrix colors={DEFAULT_COLORS} value={variants} onChange={setVariants} gemPolicy={policy}/><div style={{marginTop:12}}><div className='text-sm' style={{fontWeight:600,marginBottom:6}}>Category-specific details</div>{category?<SpecFieldset category={category} specs={specs} onSpecs={setSpecs}/>:<div className='text-xs' style={{color:'var(--muted)'}}>Choose a category to enter details.</div>}</div><div style={{marginTop:12}}><label className='block text-sm mb-1'>Describe your idea</label><textarea className='input' rows={4} value={details} onChange={e=>setDetails((e.target as HTMLTextAreaElement).value)} placeholder='Materials, stones, sizes, deadlines...'/></div></div></div></main></div>);}
